<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MNIST Digit Classifier</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <h1>ğŸ”¢ PhÃ¢n loáº¡i chá»¯ viáº¿t tay (MNIST)</h1>
  <h2>ğŸ§  MÃ´ hÃ¬nh Ä‘ang sá»­ dá»¥ng: RandomForestClassifier</h2>

  <!-- ThÃ´ng tin Ä‘á»™ chÃ­nh xÃ¡c -->
  <div class="result">
    <h2>ğŸ¯ Äá»™ chÃ­nh xÃ¡c tá»•ng thá»ƒ: {{ accuracy }}%</h2>
    <form method="post">
      <button type="submit" name="draw_cm">ğŸ“Š Váº½ biá»ƒu Ä‘á»“ confusion matrix</button>
    </form>
  </div>

  <!-- Äá»™ chÃ­nh xÃ¡c tá»«ng chá»¯ sá»‘ & Classification Report -->
  {% if per_class_accuracy %}
    <div class="tables-container">
      <div class="table-wrapper">
        <table>
          <thead>
            <tr><th>Chá»¯ sá»‘</th><th>Äá»™ chÃ­nh xÃ¡c (%)</th></tr>
          </thead>
          <tbody>
            {% for digit, acc in per_class_accuracy.items() %}
              <tr>
                <td>{{ digit }}</td>
                <td>{{ "%.2f"|format(acc * 100) }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="table-wrapper">
        {{ classification_report|safe }}
      </div>
    </div>

    <!-- TiÃªu Ä‘á» & mÃ´ táº£ -->
    <div class="tables-caption">
      <h3>ğŸ“Œ Thá»‘ng kÃª chi tiáº¿t káº¿t quáº£ phÃ¢n loáº¡i</h3>
      <p>
        Báº£ng trÃ¡i: Ä‘á»™ chÃ­nh xÃ¡c theo tá»«ng chá»¯ sá»‘ (0â€“9).<br>
        Báº£ng pháº£i: precision (Ä‘á»™ chÃ­nh xÃ¡c), recall (kháº£ nÄƒng phÃ¡t hiá»‡n), F1-score (trung bÃ¬nh), accuracy (Ä‘á»™ chÃ­nh xÃ¡c tá»•ng thá»ƒ), macro avg (trung bÃ¬nh khÃ´ng trá»ng sá»‘), weighted avg (trung bÃ¬nh cÃ³ trá»ng sá»‘).
      </p>
    </div>
  {% endif %}

  <!-- PhÃ¢n loáº¡i áº£nh táº£i lÃªn -->
  <form method="post" enctype="multipart/form-data">
    <h2>ğŸ–¼ï¸ PhÃ¢n loáº¡i áº£nh báº±ng cÃ¡ch táº£i lÃªn</h2>
    <input type="file" name="image" accept="image/*" required>
    <button type="submit" name="upload">ğŸ“¥ PhÃ¢n loáº¡i tá»« áº£nh táº£i lÃªn</button>
  </form>

  <!-- Káº¿t quáº£ dá»± Ä‘oÃ¡n -->
  {% if prediction is not none %}
    <div class="result">
      <h2>âœ… Káº¿t quáº£ dá»± Ä‘oÃ¡n: {{ prediction }}</h2>
      {% if image_url %}
        <h3>ğŸ–¼ï¸ áº¢nh báº¡n Ä‘Ã£ gá»­i:</h3>
        <img src="{{ url_for('static', filename=image_url.split('static/')[-1]) }}" width="200">
      {% endif %}
    </div>
  {% endif %}

  <!-- Confusion Matrix -->
  {% if show_cm %}
    <h2>ğŸ“Š Biá»ƒu Ä‘á»“ confusion matrix</h2>
    <img src="{{ url_for('static', filename='confusion_matrix.png') }}" width="600">
  {% endif %}
</body>
</html>
